---

- hosts: localhost

  vars:

    # Need this variable when modifing user or profile for current user with privileges. If not saved as variable
    # changes will be made to root.
    user:  "{{ ansible_user_id }}"

    pacman:
      - 'alacritty'
      - 'aws-cli'
      - 'bc' # Arbitrary precision calculator language required by bonsai.sh.
      - 'base-devel' # Needed to compile packages. Will see errors in yay if not installed.
      - 'blueman' # Blueman is a full featured Bluetooth manager written in GTK. Used to enable bluetooth widget in AwesomeWM.
      - 'bluez'
      - 'bluez-utils'
      - 'cmatrix' # Why wouldn't I want matrix in a terminal? :)
      - 'containerd' # Docker dependency
      - 'curl'
      - 'device-mapper' # Docker dependency
      - 'discord' # Yet another chat client
      - 'dnsutils' #Includes utilities like 'dig' and 'host'
      - 'dmenu' # dynamic menu for X
      - 'docker'
      - 'feh' # utility to set wallpaper background
      - 'firefox' # mozilla firefox web browser
      - 'git'
      - 'gtk-engine-murrine' # Murrine GTK+ Cairo Engine 
      - 'gtop' # Sweet implementation of htop in go. Did I saw sweet?
      - 'go' # Core compiler and tools for the Go programming language
      - 'gwenview' # Gwenview is a fast and easy to use image viewer by KDE, ideal for browsing and displaying a collection of images.
      - 'htop' # An interactive process viewer for Unix systems.
      - 'hwinfo'
      - 'kubectl' # CLI for kubernetes API
      - 'libappindicator-gtk3' # Resolves 'ValueError: Namespace AppIndicator3 not available after installing blueman.
      - 'lsof'
      - 'make'
      - 'man'
      - 'minikube' # Run a local kubernetes cluster.
      - 'neofetch' # Display system information in terminal.
      - 'networkmanager' #  Daemon and CLI (nmcli) for managing network interfaces.
      - 'network-manager-applet' # Handy system tray applet for managing network connections.
      - 'nmap'
      - 'openssh'
      - 'packer'
      - 'pavucontrol' # Simple GTK volume control tool ("mixer") for PulseAudio.
      - 'procps-ng' # Command line and full screen utilities for browsing procfs, a "pseudo" file system dynamically generated by the kernel to provide information about the status of entries in its process table.
      - 'python-pip'
      - 'ranger' # A VIM-inspired filemanager for the console https://ranger.github.io/
      - 'samba' # Good 'ol SMB ; used to transfer backups from homeassistant
      - 'sddm' # Simple Desktop Display Manager - login GUI.
      - 'spectacle'
      - 'terminus-font-otb' # Play games with Steam for Linux.
      - 'tmux' # A terminal multiplexer: tmux enables a number of terminals to be created, accessed, and controlled from a single screen.
      - 'tree'
      - 'virtualbox' # Use virtualbox-host-modules-arch.
      - 'wget'
      - 'xdotool' # Command-line X11 automation tool
      - 'xorg-xrdb' # Provides 'xrdb' utility used in .Xresources file.
      - 'xmonad'
      - 'xmonad-contrib'
      # Conflicts with virtualbox-host-modules-dkms ... see if works then delete.
      #- 'virtualbox-host-modules-arch' # VirtualBox host modules needed for shared clipboard, bridged network, etc.

    yay:
      - 'autojump-git' # Fast way to navigate filesystem.
      - 'google-chrome'
      - 'python-pywal' # Color theme generator.
      - 'teams'
      - 'toilet' # Used to process text displayed in terminal.
      - 'nordvpn-bin'
      - 'nerd-fonts-jetbrains-mono'
      - 'realvnc-vnc-viewer'
      - 'slack-desktop'
      - 'spotify' # Music client
      - 'terminus-font'
      - 'todotxt' # Command line todo list.

    dotfiles_repo: "https://github.com/patkaehuaea/dotfiles"
    dotfiles_repo_local_destination: "~/src/dotfiles"
    dotfiles_home: "~"
    dotfiles_files:
        - .config/alacritty
        - .config/picom.conf
        - .config/polybar
        - .config/rofi
        - .gitconfig
        - .gitignore
        - .shellaliases
        - .shellfn
        - .shellpaths
        - .shellvars
        - .tmux.conf
        - .todo.cfg
        - .vimrc
        - .xinitrc
        - .xprofile
        - .Xresources
        - .Xresources.d
        - .xsession
        - .zlogin
        - .zshenv
        - .zshrc

  roles:
    - kewlfft.aur # Doesn't actually do anything. Just makes namespace available for tasks.

  tasks:

    - include_role:
        name: common

    - include_role:
        name: geerlingguy.dotfiles # The .config directory must exist or role fails for files in ~/.config.

    - name: Run the equivalent of "pacman -Sy" before installs
      pacman:
        update_cache: yes
      become: yes

    - name: Install applications with pacman
      pacman:
       name: '{{ item }}'
       state: present
      loop: "{{ pacman }}"
      become: yes

    - name: use yay to install applications from the AUR
      aur:
        name: '{{ item }}'
      loop: '{{ yay }}'

    - name: Make sure bluetooth is enabled and running
      systemd:
        enabled: yes
        state: started
        name: bluetooth.service
      become: yes

    - name: Enable and start NetworkManager
      systemd:
        enabled: yes
        state: started
        name: NetworkManager
      become: yes

    - name: Make sure docker daemon is enabled and running
      systemd:
        enabled: yes
        state: started
        name: docker.service
      become: yes

    # Need in order to use docker and mount USB
    # devices in VirtualBox.
    - name: adding current user to docker and vboxusers groups
      user:
        name: "{{ user }}"
        groups: docker,vboxusers
        append: yes
      become: yes

    - name: Start and enable nordvpn service
      systemd:
        enabled: yes
        state: started
        name: nordvpnd.service
      become: yes

    - include_role:
        name: awesomewm

    # Do last since this will kill the run and
    # boot user to sddm login.
    - name: Make sure the display manager is running
      systemd:
        enabled: yes
        state: started
        name: sddm.service
      become: yes
